{% extends "@Contao/content_element/_base.html.twig" %}

{% set highlighter_css_file = 'vendor/scrivo/highlight_php/styles/foundation.css' %}

{% block before %}
    {{ parent() }}
    {% block style %}
        {% add 'highlighter_css' to head %}
            {# Lazy load styles, see https://web.dev/defer-non-critical-css/ #}
            <link rel="preload" href="{{ highlighter_css_file }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
            <noscript>
                <link rel="stylesheet" href="{{ highlighter_css_file }}">
            </noscript>
        {% endadd %}
    {% endblock %}
{% endblock %}

{% block content %}
    <pre>
        {%- apply spaceless %}
            {% if as_editor_view %}
                {% block overview %}{{ code }}{% endblock %}
            {% else %}
                {% block highlighted %}
                    {# @var \Contao\CoreBundle\Twig\Runtime\HighlightResult highlighted #}
                    {% set highlighted = code|highlight(language) %}
                    <code{% block code_attributes %}{{ attrs(code_attributes|default).addClass('hljs', highlighted.language) }}{% endblock %}>
                        {{- highlighted.value|raw -}}
                    </code>
                {% endblock %}
            {% endif -%}
        {% endapply -%}
    </pre>
{% endblock %}
